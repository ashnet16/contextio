{% extends "base.html" %}
{% block body %}
  <a href="/">Home</a>&nbsp;<a href="/mailboxes">Mailboxes</a>&nbsp;<a href="/show-Contacts"><a href="/logout">Logout</a>
  <h1>Hi {{ session['first_name'] }}</h1>
  <h2>Your Context id is: {{ session['context_id'] }}</h2>
  <h2>Your email is: {{ session['email'] }}</h2>
  {% if session['provider_name'] == 'google' %}
        Your are logged in with Google.<br />
  {% endif %}
  {% if(user.pending_sync) %}
    <p>Your mailbox is currently being processed. Your screen will refresh once complete</p>
  {% elif(user.pending_contacts) %}
    <h2>Your contacts</h2>
    <p>To allow us to analyze your mailbox effectively you need to select one or more contact to include</p>
    <p>Selects the contacts you wish to analyse the click <a href="javascript: doAnalysis()">here</a>
    <p> Currently displaying a list of 10 contacts</p>
    <table>
      <thead><tr><td>Username</td><td></td></tr></thead>
    {% for contact in contactList %}
      <tr><td>{{ contact }}</td><td><a href="javascript: addContact('{{ contact }}')">Add</button></tr>
    {% endfor %}
  </table>
      <script>
      function doAnalysis() {
          $.ajax({
           url: '/do-analysis',
           type: 'POST',
           data: JSON.stringify({}, null, '\t'),
           contentType: 'application/json;charset=UTF-8',
           success: function(response) {
            window.location = '/inbox'
           },
           error: function(error) {
             console.log(error);
           }
         });
        }

        function addContact(email) {
          var contactEmailObj = {
            "email":email
          };
          $.ajax({
           url: '/selectContact',
           type: 'POST',
           data: JSON.stringify(contactEmailObj, null, '\t'),
           contentType: 'application/json;charset=UTF-8',
           success: function(response) {
            console.log(success)
           },
           error: function(error) {
             console.log(error);
           }
         });
        };
      </script>
      <a id="showMoreContacts" href="/showMoreContacts">See more contacts</a>
  {% elif(user.pending_analysis) %}
    <p>Our cognitive minions are currently analysing your mailbox. Your screen will resfesh once complete</p>
  {% else %}
  <h2> Messages and Tones</h2>
  <p> {{ jsonOut }}
  {% for m in msgs %}
    <div><p>Message is {{ m }}  </p></div>
  {% endfor %}
  {% for t in tones %}
    <div><p>Tone is {{ t }}  </p></div>
  {% endfor %}
  {% endif %}
{% endblock body %}
